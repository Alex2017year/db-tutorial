<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis 运维 | DB-TUTORIAL</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/db-tutorial/favicon.ico">
    <meta name="description" content="数据库教程">
    <link rel="preload" href="/db-tutorial/assets/css/0.styles.9890eb14.css" as="style"><link rel="preload" href="/db-tutorial/assets/js/app.1637c1a8.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/4.988cd28a.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/33.d8a98227.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/5.97e60065.js" as="script"><link rel="prefetch" href="/db-tutorial/assets/js/10.d6c4ab98.js"><link rel="prefetch" href="/db-tutorial/assets/js/11.bcdc854a.js"><link rel="prefetch" href="/db-tutorial/assets/js/12.b1c5ccd6.js"><link rel="prefetch" href="/db-tutorial/assets/js/13.0231d26c.js"><link rel="prefetch" href="/db-tutorial/assets/js/14.1353e10c.js"><link rel="prefetch" href="/db-tutorial/assets/js/15.77beb8c8.js"><link rel="prefetch" href="/db-tutorial/assets/js/16.95cb18f5.js"><link rel="prefetch" href="/db-tutorial/assets/js/17.391d32ef.js"><link rel="prefetch" href="/db-tutorial/assets/js/18.962a1d95.js"><link rel="prefetch" href="/db-tutorial/assets/js/19.4fe1aa3c.js"><link rel="prefetch" href="/db-tutorial/assets/js/20.fd0add2b.js"><link rel="prefetch" href="/db-tutorial/assets/js/21.9c5de472.js"><link rel="prefetch" href="/db-tutorial/assets/js/22.58cf4ab2.js"><link rel="prefetch" href="/db-tutorial/assets/js/23.4e1a22c2.js"><link rel="prefetch" href="/db-tutorial/assets/js/24.cc3769c6.js"><link rel="prefetch" href="/db-tutorial/assets/js/25.e2074f54.js"><link rel="prefetch" href="/db-tutorial/assets/js/26.befb3037.js"><link rel="prefetch" href="/db-tutorial/assets/js/27.b4d75a01.js"><link rel="prefetch" href="/db-tutorial/assets/js/28.3f95cfb3.js"><link rel="prefetch" href="/db-tutorial/assets/js/29.8f97f10b.js"><link rel="prefetch" href="/db-tutorial/assets/js/30.39d20b2c.js"><link rel="prefetch" href="/db-tutorial/assets/js/31.fc2f71e8.js"><link rel="prefetch" href="/db-tutorial/assets/js/32.04c7c31e.js"><link rel="prefetch" href="/db-tutorial/assets/js/34.f3f76f91.js"><link rel="prefetch" href="/db-tutorial/assets/js/35.9e1d9fd5.js"><link rel="prefetch" href="/db-tutorial/assets/js/36.8223f208.js"><link rel="prefetch" href="/db-tutorial/assets/js/37.2e5375d8.js"><link rel="prefetch" href="/db-tutorial/assets/js/38.0873d536.js"><link rel="prefetch" href="/db-tutorial/assets/js/39.0daadf13.js"><link rel="prefetch" href="/db-tutorial/assets/js/40.9dff4cfb.js"><link rel="prefetch" href="/db-tutorial/assets/js/41.f8b293a9.js"><link rel="prefetch" href="/db-tutorial/assets/js/42.550ed28e.js"><link rel="prefetch" href="/db-tutorial/assets/js/43.622c2625.js"><link rel="prefetch" href="/db-tutorial/assets/js/44.0fc5b838.js"><link rel="prefetch" href="/db-tutorial/assets/js/45.5a4964c8.js"><link rel="prefetch" href="/db-tutorial/assets/js/46.c49dba33.js"><link rel="prefetch" href="/db-tutorial/assets/js/47.53ce644b.js"><link rel="prefetch" href="/db-tutorial/assets/js/48.83d4e4ce.js"><link rel="prefetch" href="/db-tutorial/assets/js/49.36414ad9.js"><link rel="prefetch" href="/db-tutorial/assets/js/50.1394d06e.js"><link rel="prefetch" href="/db-tutorial/assets/js/51.0fea6988.js"><link rel="prefetch" href="/db-tutorial/assets/js/52.f10ee7c4.js"><link rel="prefetch" href="/db-tutorial/assets/js/53.f598ca7d.js"><link rel="prefetch" href="/db-tutorial/assets/js/54.6408c8d2.js"><link rel="prefetch" href="/db-tutorial/assets/js/6.0b3ccab2.js"><link rel="prefetch" href="/db-tutorial/assets/js/7.ac8df731.js"><link rel="prefetch" href="/db-tutorial/assets/js/8.df37c1ad.js"><link rel="prefetch" href="/db-tutorial/assets/js/9.0382c4b4.js"><link rel="prefetch" href="/db-tutorial/assets/js/vendors~flowchart.8982e116.js"><link rel="prefetch" href="/db-tutorial/assets/js/vendors~notification.f509967c.js">
    <link rel="stylesheet" href="/db-tutorial/assets/css/0.styles.9890eb14.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/db-tutorial/" class="home-link router-link-active"><img src="images/dunwu-logo-100.png" alt="DB-TUTORIAL" class="logo"> <span class="site-name can-hide">DB-TUTORIAL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="sql" class="dropdown-title"><span class="title">sql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/sql/mysql/" class="nav-link">
  Mysql
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="nosql" class="dropdown-title"><span class="title">nosql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/nosql/redis/" class="nav-link router-link-active">
  Redis
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎯 博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/db-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="sql" class="dropdown-title"><span class="title">sql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/sql/mysql/" class="nav-link">
  Mysql
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="nosql" class="dropdown-title"><span class="title">nosql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/nosql/redis/" class="nav-link router-link-active">
  Redis
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎯 博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/db-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Redis 运维</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/nosql/redis/redis-ops.html#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-ops.html#window-下安装" class="sidebar-link">Window 下安装</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-ops.html#linux-下安装" class="sidebar-link">Linux 下安装</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-ops.html#ubuntu-下安装" class="sidebar-link">Ubuntu 下安装</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-ops.html#开机启动" class="sidebar-link">开机启动</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-ops.html#开放防火墙端口" class="sidebar-link">开放防火墙端口</a></li></ul></li><li><a href="/db-tutorial/nosql/redis/redis-ops.html#redis-使用和配置" class="sidebar-link">Redis 使用和配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-ops.html#启动" class="sidebar-link">启动</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-ops.html#常见配置" class="sidebar-link">常见配置</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-ops.html#设为守护进程" class="sidebar-link">设为守护进程</a></li></ul></li><li><a href="/db-tutorial/nosql/redis/redis-ops.html#redis-集群使用和配置" class="sidebar-link">Redis 集群使用和配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-ops.html#集群规划" class="sidebar-link">集群规划</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-ops.html#部署" class="sidebar-link">部署</a></li></ul></li><li><a href="/db-tutorial/nosql/redis/redis-ops.html#redis-命令" class="sidebar-link">Redis 命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-ops.html#通用命令" class="sidebar-link">通用命令</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-ops.html#集群命令" class="sidebar-link">集群命令</a></li></ul></li><li><a href="/db-tutorial/nosql/redis/redis-ops.html#压力测试" class="sidebar-link">压力测试</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/nosql/redis/redis-ops.html#客户端" class="sidebar-link">客户端</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/nosql/redis/redis-ops.html#脚本" class="sidebar-link">脚本</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/nosql/redis/redis-ops.html#参考资料" class="sidebar-link">参考资料</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis-运维"><a href="#redis-运维" class="header-anchor">#</a> Redis 运维</h1> <blockquote><p><strong>Redis</strong> 是一个高性能的 key-value 数据库。</p> <p>SET 操作每秒钟 110000 次；GET 操作每秒钟 81000 次。</p></blockquote> <ul><li><a href="#%E5%AE%89%E8%A3%85">安装</a> <ul><li><a href="#window-%E4%B8%8B%E5%AE%89%E8%A3%85">Window 下安装</a></li> <li><a href="#linux-%E4%B8%8B%E5%AE%89%E8%A3%85">Linux 下安装</a></li> <li><a href="#ubuntu-%E4%B8%8B%E5%AE%89%E8%A3%85">Ubuntu 下安装</a></li> <li><a href="#%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8">开机启动</a></li> <li><a href="#%E5%BC%80%E6%94%BE%E9%98%B2%E7%81%AB%E5%A2%99%E7%AB%AF%E5%8F%A3">开放防火墙端口</a></li></ul></li> <li><a href="#redis-%E4%BD%BF%E7%94%A8%E5%92%8C%E9%85%8D%E7%BD%AE">Redis 使用和配置</a> <ul><li><a href="#%E5%90%AF%E5%8A%A8">启动</a></li> <li><a href="#%E5%B8%B8%E8%A7%81%E9%85%8D%E7%BD%AE">常见配置</a></li> <li><a href="#%E8%AE%BE%E4%B8%BA%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B">设为守护进程</a></li></ul></li> <li><a href="#redis-%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8%E5%92%8C%E9%85%8D%E7%BD%AE">Redis 集群使用和配置</a> <ul><li><a href="#%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92">集群规划</a></li> <li><a href="#%E9%83%A8%E7%BD%B2">部署</a></li></ul></li> <li><a href="#redis-%E5%91%BD%E4%BB%A4">Redis 命令</a> <ul><li><a href="#%E9%80%9A%E7%94%A8%E5%91%BD%E4%BB%A4">通用命令</a></li> <li><a href="#%E9%9B%86%E7%BE%A4%E5%91%BD%E4%BB%A4">集群命令</a></li></ul></li> <li><a href="#%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95">压力测试</a></li> <li><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF">客户端</a></li> <li><a href="#%E8%84%9A%E6%9C%AC">脚本</a></li> <li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li></ul> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <h3 id="window-下安装"><a href="#window-下安装" class="header-anchor">#</a> Window 下安装</h3> <p><strong>下载地址：</strong><a href="https://github.com/MSOpenTech/redis/releases" target="_blank" rel="noopener noreferrer">https://github.com/MSOpenTech/redis/releases<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>Redis 支持 32 位和 64 位。这个需要根据你系统平台的实际情况选择，这里我们下载 <strong>Redis-x64-xxx.zip</strong>压缩包到 C 盘，解压后，将文件夹重新命名为 <strong>redis</strong>。</p> <p>打开一个 <strong>cmd</strong> 窗口 使用 cd 命令切换目录到 <strong>C:\redis</strong> 运行 <strong>redis-server.exe redis.windows.conf</strong> 。</p> <p>如果想方便的话，可以把 redis 的路径加到系统的环境变量里，这样就省得再输路径了，后面的那个 redis.windows.conf 可以省略，如果省略，会启用默认的。</p> <p>这时候另启一个 cmd 窗口，原来的不要关闭，不然就无法访问服务端了。</p> <p>切换到 redis 目录下运行 <strong>redis-cli.exe -h 127.0.0.1 -p 6379</strong> 。</p> <h3 id="linux-下安装"><a href="#linux-下安装" class="header-anchor">#</a> Linux 下安装</h3> <p><strong>下载地址：</strong> http://redis.io/download，下载最新文档版本。</p> <p>下载、解压、编译 Redis</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">wget</span> http://download.redis.io/releases/redis-5.0.4.tar.gz
<span class="token function">tar</span> xzf redis-5.0.4.tar.gz
<span class="token builtin class-name">cd</span> redis-5.0.4
<span class="token function">make</span>
</code></pre></div><p>为了编译 Redis 源码，你需要 gcc-c++和 tcl。如果你的系统是 CentOS，可以直接执行命令：<code>yum install -y gcc-c++ tcl</code> 来安装。</p> <p>进入到解压后的 <code>src</code> 目录，通过如下命令启动 Redis:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>src/redis-server
</code></pre></div><p>您可以使用内置的客户端与 Redis 进行交互:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ src/redis-cli
redis<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> foo bar
OK
redis<span class="token operator">&gt;</span> get foo
<span class="token string">&quot;bar&quot;</span>
</code></pre></div><h3 id="ubuntu-下安装"><a href="#ubuntu-下安装" class="header-anchor">#</a> Ubuntu 下安装</h3> <p>在 Ubuntu 系统安装 Redis 可以使用以下命令:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> redis-server
</code></pre></div><h3 id="开机启动"><a href="#开机启动" class="header-anchor">#</a> 开机启动</h3> <ul><li>开机启动配置：<code>echo &quot;/usr/local/bin/redis-server /etc/redis.conf&quot; &gt;&gt; /etc/rc.local</code></li></ul> <h3 id="开放防火墙端口"><a href="#开放防火墙端口" class="header-anchor">#</a> 开放防火墙端口</h3> <ul><li>添加规则：<code>iptables -I INPUT -p tcp -m tcp --dport 6379 -j ACCEPT</code></li> <li>保存规则：<code>service iptables save</code></li> <li>重启 iptables：<code>service iptables restart</code></li></ul> <h2 id="redis-使用和配置"><a href="#redis-使用和配置" class="header-anchor">#</a> Redis 使用和配置</h2> <h3 id="启动"><a href="#启动" class="header-anchor">#</a> 启动</h3> <p><strong>启动 redis 服务</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /usr/local/redis/src
./redis-server
</code></pre></div><p><strong>启动 redis 客户端</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /usr/local/redis/src
./redis-cli
</code></pre></div><p><strong>查看 redis 是否启动</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>redis-cli
</code></pre></div><p>以上命令将打开以下终端：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>redis <span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre></div><p>127.0.0.1 是本机 IP ，6379 是 redis 服务端口。现在我们输入 PING 命令。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>redis <span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">ping</span>
PONG
</code></pre></div><p>以上说明我们已经成功启动了 redis。</p> <h3 id="常见配置"><a href="#常见配置" class="header-anchor">#</a> 常见配置</h3> <blockquote><p>Redis 默认的配置文件是根目录下的 <code>redis.conf</code> 文件。</p> <p>如果需要指定特定文件作为配置文件，需要使用命令： <code>./redis-server -c xxx.conf</code></p> <p>每次修改配置后，需要重启才能生效。</p> <p>Redis 官方默认配置：</p> <ul><li>自描述文档 <a href="https://raw.githubusercontent.com/antirez/redis/2.8/redis.conf" target="_blank" rel="noopener noreferrer">redis.conf for Redis 2.8<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>自描述文档 <a href="https://raw.githubusercontent.com/antirez/redis/2.6/redis.conf" target="_blank" rel="noopener noreferrer">redis.conf for Redis 2.6<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li> <li>自描述文档 <a href="https://raw.githubusercontent.com/antirez/redis/2.4/redis.conf" target="_blank" rel="noopener noreferrer">redis.conf for Redis 2.4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li></ul> <p>自 Redis2.6 起就可以直接通过命令行传递 Redis 配置参数。这种方法可以用于测试。自 Redis2.6 起就可以直接通过命令行传递 Redis 配置参数。这种方法可以用于测试。</p></blockquote> <h3 id="设为守护进程"><a href="#设为守护进程" class="header-anchor">#</a> 设为守护进程</h3> <p>Redis 默认以非守护进程方式启动，而通常我们会将 Redis 设为守护进程启动方式，配置：<code>daemonize yes</code></p> <h4 id="远程访问"><a href="#远程访问" class="header-anchor">#</a> 远程访问</h4> <p>Redis 默认绑定 127.0.0.1，这样就只能本机才能访问，若要 Redis 允许远程访问，需要配置：<code>bind 0.0.0.0</code></p> <h4 id="设置密码"><a href="#设置密码" class="header-anchor">#</a> 设置密码</h4> <p>Redis 默认访问不需要密码，如果需要设置密码，需要如下配置：</p> <ul><li><code>protected-mode yes</code></li> <li><code>requirepass &lt;密码&gt;</code></li></ul> <h4 id="配置参数表"><a href="#配置参数表" class="header-anchor">#</a> 配置参数表</h4> <table><thead><tr><th style="text-align:left;">配置项</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>daemonize no</code></td> <td style="text-align:left;">Redis 默认不是以守护进程的方式运行，可以通过该配置项修改，使用 yes 启用守护进程（Windows 不支持守护线程的配置为 no ）</td></tr> <tr><td style="text-align:left;"><code>pidfile /var/run/redis.pid</code></td> <td style="text-align:left;">当 Redis 以守护进程方式运行时，Redis 默认会把 pid 写入 /var/run/redis.pid 文件，可以通过 pidfile 指定</td></tr> <tr><td style="text-align:left;"><code>port 6379</code></td> <td style="text-align:left;">指定 Redis 监听端口，默认端口为 6379，作者在自己的一篇博文中解释了为什么选用 6379 作为默认端口，因为 6379 在手机按键上 MERZ 对应的号码，而 MERZ 取自意大利歌女 Alessia Merz 的名字</td></tr> <tr><td style="text-align:left;"><code>bind 127.0.0.1</code></td> <td style="text-align:left;">绑定的主机地址</td></tr> <tr><td style="text-align:left;"><code>timeout 300</code></td> <td style="text-align:left;">当客户端闲置多长时间后关闭连接，如果指定为 0，表示关闭该功能</td></tr> <tr><td style="text-align:left;"><code>loglevel notice</code></td> <td style="text-align:left;">指定日志记录级别，Redis 总共支持四个级别：debug、verbose、notice、warning，默认为 notice</td></tr> <tr><td style="text-align:left;"><code>logfile stdout</code></td> <td style="text-align:left;">日志记录方式，默认为标准输出，如果配置 Redis 为守护进程方式运行，而这里又配置为日志记录方式为标准输出，则日志将会发送给 /dev/null</td></tr> <tr><td style="text-align:left;"><code>databases 16</code></td> <td style="text-align:left;">设置数据库的数量，默认数据库为 0，可以使用 SELECT 命令在连接上指定数据库 id</td></tr> <tr><td style="text-align:left;"><code>save &lt;seconds&gt; &lt;changes&gt;</code> Redis 默认配置文件中提供了三个条件：<strong>save 900 1</strong>、<strong>save 300 10</strong>、<strong>save 60 10000</strong> 分别表示 900 秒（15 分钟）内有 1 个更改，300 秒（5 分钟）内有 10 个更改以及 60 秒内有 10000 个更改。</td> <td style="text-align:left;">指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</td></tr> <tr><td style="text-align:left;"><code>rdbcompression yes</code></td> <td style="text-align:left;">指定存储至本地数据库时是否压缩数据，默认为 yes，Redis 采用 LZF 压缩，如果为了节省 CPU 时间，可以关闭该选项，但会导致数据库文件变的巨大</td></tr> <tr><td style="text-align:left;"><code>dbfilename dump.rdb</code></td> <td style="text-align:left;">指定本地数据库文件名，默认值为 dump.rdb</td></tr> <tr><td style="text-align:left;"><code>dir ./</code></td> <td style="text-align:left;">指定本地数据库存放目录</td></tr> <tr><td style="text-align:left;"><code>slaveof &lt;masterip&gt; &lt;masterport&gt;</code></td> <td style="text-align:left;">设置当本机为 slav 服务时，设置 master 服务的 IP 地址及端口，在 Redis 启动时，它会自动从 master 进行数据同步</td></tr> <tr><td style="text-align:left;"><code>masterauth &lt;master-password&gt;</code></td> <td style="text-align:left;">当 master 服务设置了密码保护时，slav 服务连接 master 的密码</td></tr> <tr><td style="text-align:left;"><code>requirepass foobared</code></td> <td style="text-align:left;">设置 Redis 连接密码，如果配置了连接密码，客户端在连接 Redis 时需要通过 AUTH <password> 命令提供密码，默认关闭</password></td></tr> <tr><td style="text-align:left;"><code>maxclients 128</code></td> <td style="text-align:left;">设置同一时间最大客户端连接数，默认无限制，Redis 可以同时打开的客户端连接数为 Redis 进程可以打开的最大文件描述符数，如果设置 maxclients 0，表示不作限制。当客户端连接数到达限制时，Redis 会关闭新的连接并向客户端返回 max number of clients reached 错误信息</td></tr> <tr><td style="text-align:left;"><code>maxmemory &lt;bytes&gt;</code></td> <td style="text-align:left;">指定 Redis 最大内存限制，Redis 在启动时会把数据加载到内存中，达到最大内存后，Redis 会先尝试清除已到期或即将到期的 Key，当此方法处理 后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作。Redis 新的 vm 机制，会把 Key 存放内存，Value 会存放在 swap 区</td></tr> <tr><td style="text-align:left;"><code>appendonly no</code></td> <td style="text-align:left;">指定是否在每次更新操作后进行日志记录，Redis 在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一段时间内的数据丢失。因为 redis 本身同步数据文件是按上面 save 条件来同步的，所以有的数据会在一段时间内只存在于内存中。默认为 no</td></tr> <tr><td style="text-align:left;"><code>appendfilename appendonly.aof</code></td> <td style="text-align:left;">指定更新日志文件名，默认为 appendonly.aof</td></tr> <tr><td style="text-align:left;"><code>appendfsync everysec</code></td> <td style="text-align:left;">指定更新日志条件，共有 3 个可选值：<strong>no</strong>：表示等操作系统进行数据缓存同步到磁盘（快）<strong>always</strong>：表示每次更新操作后手动调用 fsync() 将数据写到磁盘（慢，安全）<strong>everysec</strong>：表示每秒同步一次（折中，默认值）</td></tr> <tr><td style="text-align:left;"><code>vm-enabled no</code></td> <td style="text-align:left;">指定是否启用虚拟内存机制，默认值为 no，简单的介绍一下，VM 机制将数据分页存放，由 Redis 将访问量较少的页即冷数据 swap 到磁盘上，访问多的页面由磁盘自动换出到内存中（在后面的文章我会仔细分析 Redis 的 VM 机制）</td></tr> <tr><td style="text-align:left;"><code>vm-swap-file /tmp/redis.swap</code></td> <td style="text-align:left;">虚拟内存文件路径，默认值为 /tmp/redis.swap，不可多个 Redis 实例共享</td></tr> <tr><td style="text-align:left;"><code>vm-max-memory 0</code></td> <td style="text-align:left;">将所有大于 vm-max-memory 的数据存入虚拟内存，无论 vm-max-memory 设置多小，所有索引数据都是内存存储的(Redis 的索引数据 就是 keys)，也就是说，当 vm-max-memory 设置为 0 的时候，其实是所有 value 都存在于磁盘。默认值为 0</td></tr> <tr><td style="text-align:left;"><code>vm-page-size 32</code></td> <td style="text-align:left;">Redis swap 文件分成了很多的 page，一个对象可以保存在多个 page 上面，但一个 page 上不能被多个对象共享，vm-page-size 是要根据存储的 数据大小来设定的，作者建议如果存储很多小对象，page 大小最好设置为 32 或者 64bytes；如果存储很大大对象，则可以使用更大的 page，如果不确定，就使用默认值</td></tr> <tr><td style="text-align:left;"><code>vm-pages 134217728</code></td> <td style="text-align:left;">设置 swap 文件中的 page 数量，由于页表（一种表示页面空闲或使用的 bitmap）是在放在内存中的，，在磁盘上每 8 个 pages 将消耗 1byte 的内存。</td></tr> <tr><td style="text-align:left;"><code>vm-max-threads 4</code></td> <td style="text-align:left;">设置访问 swap 文件的线程数,最好不要超过机器的核数,如果设置为 0,那么所有对 swap 文件的操作都是串行的，可能会造成比较长时间的延迟。默认值为 4</td></tr> <tr><td style="text-align:left;"><code>glueoutputbuf yes</code></td> <td style="text-align:left;">设置在向客户端应答时，是否把较小的包合并为一个包发送，默认为开启</td></tr> <tr><td style="text-align:left;"><code>hash-max-zipmap-entries 64 hash-max-zipmap-value 512</code></td> <td style="text-align:left;">指定在超过一定的数量或者最大的元素超过某一临界值时，采用一种特殊的哈希算法</td></tr> <tr><td style="text-align:left;"><code>activerehashing yes</code></td> <td style="text-align:left;">指定是否激活重置哈希，默认为开启（后面在介绍 Redis 的哈希算法时具体介绍）</td></tr> <tr><td style="text-align:left;"><code>include /path/to/local.conf</code></td> <td style="text-align:left;">指定包含其它的配置文件，可以在同一主机上多个 Redis 实例之间使用同一份配置文件，而同时各个实例又拥有自己的特定配置文件</td></tr></tbody></table> <h2 id="redis-集群使用和配置"><a href="#redis-集群使用和配置" class="header-anchor">#</a> Redis 集群使用和配置</h2> <p>Redis 3.0 后支持集群模式。</p> <h3 id="集群规划"><a href="#集群规划" class="header-anchor">#</a> 集群规划</h3> <p><code>Redis</code> 集群一般由 <strong>多个节点</strong> 组成，节点数量至少为 <code>6</code> 个，才能保证组成 <strong>完整高可用</strong> 的集群。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/10/10/16db5250b0d1c392?w=1467&amp;h=803&amp;f=png&amp;s=43428" alt="img"></p> <p>理想情况当然是所有节点各自在不同的机器上，首先于资源，本人在部署 Redis 集群时，只得到 3 台服务器。所以，我计划每台服务器部署 2 个 Redis 节点。</p> <h3 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h3> <p>Redis 集群节点的安装与单节点服务相同，差异仅在于部署方式。</p> <p>假设三台服务器地址如下：</p> <ul><li>服务 A：127.0.0.1</li> <li>服务 B：127.0.0.2</li> <li>服务 C：127.0.0.3</li></ul> <p>分配如下：</p> <table><thead><tr><th>127.0.0.1</th> <th>127.0.0.2</th> <th>127.0.0.3</th></tr></thead> <tbody><tr><td>127.0.0.1:6381</td> <td>127.0.0.2:6383</td> <td>127.0.0.3:6385</td></tr> <tr><td>127.0.0.1:6382</td> <td>127.0.0.2:6384</td> <td>127.0.0.3:6386</td></tr></tbody></table> <h4 id="（1）创建节点目录"><a href="#（1）创建节点目录" class="header-anchor">#</a> （1）创建节点目录</h4> <p>我个人偏好将软件放在 <code>/opt</code> 目录下，在我的机器中，Redis 都安装在 <code>/usr/local/redis</code> 目录下。所以，下面的命令和配置都假设 Redis 安装目录为 <code>/usr/local/redis</code> 。</p> <p>确保机器上已经安装了 Redis 后，执行以下命令，创建 Redis 集群节点实例目录：</p> <ul><li>127.0.0.1</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /usr/local/redis/cluster/6381
<span class="token function">sudo</span> <span class="token function">mkdir</span> -p /usr/local/redis/cluster/6382
</code></pre></div><ul><li>127.0.0.2</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /usr/local/redis/cluster/6383
<span class="token function">sudo</span> <span class="token function">mkdir</span> -p /usr/local/redis/cluster/6384
</code></pre></div><ul><li>127.0.0.3</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /usr/local/redis/cluster/6385
<span class="token function">sudo</span> <span class="token function">mkdir</span> -p /usr/local/redis/cluster/6386
</code></pre></div><h4 id="（2）集群节点实例配置"><a href="#（2）集群节点实例配置" class="header-anchor">#</a> （2）集群节点实例配置</h4> <p>每个实例目录下，新建 <code>redis.conf</code> 配置文件。</p> <p>实例配置模板以 6381 节点为例（其他节点，完全替换配置中的端口号 6381 即可），如下：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 端口号</span>
port <span class="token number">6381</span>
<span class="token comment"># 绑定的主机端口（0.0.0.0 表示允许远程访问）</span>
<span class="token builtin class-name">bind</span> <span class="token number">0.0</span>.0.0
<span class="token comment"># 以守护进程方式启动</span>
daemonize <span class="token function">yes</span>

<span class="token comment"># 开启集群模式</span>
cluster-enabled <span class="token function">yes</span>
<span class="token comment"># 集群的配置，配置文件首次启动自动生成</span>
cluster-config-file /usr/local/redis/cluster/6381/6381.conf
<span class="token comment"># 请求超时时间，设置 10 秒</span>
cluster-node-timeout <span class="token number">10000</span>

<span class="token comment"># 开启 AOF 持久化</span>
appendonly <span class="token function">yes</span>
<span class="token comment"># 数据存放目录</span>
<span class="token function">dir</span> /usr/local/redis/cluster/6381
<span class="token comment"># 进程文件</span>
pidfile /var/run/redis/redis-6381.pid
<span class="token comment"># 日志文件</span>
logfile /usr/local/redis/cluster/6381/6381.log
</code></pre></div><h4 id="（3）启动-redis-节点"><a href="#（3）启动-redis-节点" class="header-anchor">#</a> （3）启动 Redis 节点</h4> <p>Redis 的 utils/create-cluster 目录下自带了一个名为 create-cluster 的脚本工具，可以利用它来新建、启动、停止、重启 Redis 节点。</p> <p>脚本中有几个关键参数：</p> <ul><li><code>PORT</code>=30000 - 初始端口号</li> <li><code>TIMEOUT</code>=2000 - 超时时间</li> <li><code>NODES</code>=6 - 节点数</li> <li><code>REPLICAS</code>=1 - 备份数</li></ul> <p>脚本中的每个命令项会根据初始端口号，以及设置的节点数，遍历的去执行操作。</p> <p>由于前面的规划中，节点端口是从 6381 ~ 6386，所以需要将 PORT 变量设为 6380。</p> <p>脚本中启动每个 Redis 节点是通过指定命令行参数来配置属性。所以，我们需要改一下：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;start&quot;</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
    <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$((</span>PORT <span class="token operator">&lt;</span> ENDPORT<span class="token variable">))</span></span> <span class="token operator">!=</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>PORT<span class="token operator">+</span><span class="token number">1</span><span class="token variable">))</span></span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;Starting <span class="token variable">$PORT</span>&quot;</span>
        /usr/local/redis/src/redis-server /usr/local/redis/cluster/<span class="token variable">${PORT}</span>/redis.conf
    <span class="token keyword">done</span>
    <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token keyword">fi</span>
</code></pre></div><p>好了，在每台服务器上，都执行 <code>./create-cluster start</code> 来启动节点。</p> <p>然后，通过 ps 命令来确认 Redis 进程是否已经工作：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> redis
root     <span class="token number">12036</span>     <span class="token number">1</span> <span class="token number">12</span> <span class="token number">16</span>:26 ?        00:08:28 /usr/local/redis/src/redis-server <span class="token number">0.0</span>.0.0:6381 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root     <span class="token number">12038</span>     <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">16</span>:26 ?        00:00:03 /usr/local/redis/src/redis-server <span class="token number">0.0</span>.0.0:6382 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
</code></pre></div><h4 id="（4）启动集群"><a href="#（4）启动集群" class="header-anchor">#</a> （4）启动集群</h4> <p>通过 <code>redis-cli --cluster create</code> 命令可以自动配置集群，如下：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>/usr/local/redis/src/redis-cli --cluster create <span class="token number">127.0</span>.0.1:6381 <span class="token number">127.0</span>.0.1:6382 <span class="token number">127.0</span>.0.2:6383 <span class="token number">127.0</span>.0.2:6384 <span class="token number">127.0</span>.0.3:6385 <span class="token number">127.0</span>.0.3:6386 --cluster-replicas <span class="token number">1</span>
</code></pre></div><p>如果启动成功，可以看到如下信息：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing <span class="token builtin class-name">hash</span> slots allocation on <span class="token number">6</span> nodes<span class="token punctuation">..</span>.
Master<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">0</span> - <span class="token number">5460</span>
Master<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">5461</span> - <span class="token number">10922</span>
Master<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">10923</span> - <span class="token number">16383</span>
Adding replica <span class="token number">127.0</span>.0.2:6384 to <span class="token number">127.0</span>.0.1:6381
Adding replica <span class="token number">127.0</span>.0.3:6386 to <span class="token number">127.0</span>.0.2:6383
Adding replica <span class="token number">127.0</span>.0.1:6382 to <span class="token number">127.0</span>.0.3:6385
M: 75527b790e46530ea271a5b78f9e0fd9030f68e0 <span class="token number">127.0</span>.0.1:6381
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
S: 031dd0fd5ad90fa26fcf45d49ad906d063611a6d <span class="token number">127.0</span>.0.1:6382
   replicates 53012ebdd25005840da9ecbe07d937296a264206
M: 0cfbceec272b6ff70e1dfb5c5346a5cb2c20c884 <span class="token number">127.0</span>.0.2:6383
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
S: 016ae9624202891cc6f2b480ff0634de478197fb <span class="token number">127.0</span>.0.2:6384
   replicates 75527b790e46530ea271a5b78f9e0fd9030f68e0
M: 53012ebdd25005840da9ecbe07d937296a264206 <span class="token number">127.0</span>.0.3:6385
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
S: b6d70f2ed78922b1dcb7967ebe1d05ad9157fca8 <span class="token number">127.0</span>.0.3:6386
   replicates 0cfbceec272b6ff70e1dfb5c5346a5cb2c20c884
Can I <span class="token builtin class-name">set</span> the above configuration? <span class="token punctuation">(</span>type <span class="token string">'yes'</span> to accept<span class="token punctuation">)</span>: <span class="token function">yes</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Nodes configuration updated
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Assign a different config epoch to each node
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER MEET messages to <span class="token function">join</span> the cluster
Waiting <span class="token keyword">for</span> the cluster to <span class="token function">join</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using node <span class="token number">127.0</span>.0.1:6381<span class="token punctuation">)</span>
M: 75527b790e46530ea271a5b78f9e0fd9030f68e0 <span class="token number">127.0</span>.0.1:6381
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 0cfbceec272b6ff70e1dfb5c5346a5cb2c20c884 <span class="token number">127.0</span>.0.2:6383
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 016ae9624202891cc6f2b480ff0634de478197fb <span class="token number">127.0</span>.0.2:6384
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 75527b790e46530ea271a5b78f9e0fd9030f68e0
M: 53012ebdd25005840da9ecbe07d937296a264206 <span class="token number">127.0</span>.0.3:6385
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 031dd0fd5ad90fa26fcf45d49ad906d063611a6d <span class="token number">127.0</span>.0.1:6382
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 53012ebdd25005840da9ecbe07d937296a264206
S: b6d70f2ed78922b1dcb7967ebe1d05ad9157fca8 <span class="token number">127.0</span>.0.3:6386
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 0cfbceec272b6ff70e1dfb5c5346a5cb2c20c884
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
</code></pre></div><h4 id="（5）日常维护操作"><a href="#（5）日常维护操作" class="header-anchor">#</a> （5）日常维护操作</h4> <ul><li>关闭集群 - <code>./create-cluster stop</code></li> <li>检查集群是否健康（指定任意节点即可）：<code>./redis-cli --cluster check &lt;ip:port&gt;</code></li> <li>尝试修复集群节点：<code>./redis-cli --cluster fix &lt;ip:port&gt;</code></li></ul> <h2 id="redis-命令"><a href="#redis-命令" class="header-anchor">#</a> Redis 命令</h2> <h3 id="通用命令"><a href="#通用命令" class="header-anchor">#</a> 通用命令</h3> <blockquote><p>命令详细用法，请参考 <a href="https://redis.io/commands" target="_blank" rel="noopener noreferrer"><strong>Redis 命令官方文档</strong><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>搬迁两张 cheat sheet 图，原址：https://www.cheatography.com/tasjaevan/cheat-sheets/redis/</p></blockquote> <p><img src="https://user-gold-cdn.xitu.io/2019/10/10/16db5250b0b8ea57?w=2230&amp;h=2914&amp;f=png&amp;s=246433" alt="img"></p> <p><img src="https://user-gold-cdn.xitu.io/2019/10/10/16db5250b0e9ba3c?w=2229&amp;h=2890&amp;f=png&amp;s=192997" alt="img"></p> <h3 id="集群命令"><a href="#集群命令" class="header-anchor">#</a> 集群命令</h3> <ul><li><strong>集群</strong> <ul><li><code>cluster info</code> - 打印集群的信息</li> <li><code>cluster nodes</code> - 列出集群当前已知的所有节点（ node），以及这些节点的相关信息。</li></ul></li> <li><strong>节点</strong> <ul><li><code>cluster meet &lt;ip&gt; &lt;port&gt;</code> - 将 ip 和 port 所指定的节点添加到集群当中，让它成为集群的一份子。</li> <li><code>cluster forget &lt;node_id&gt;</code> - 从集群中移除 node_id 指定的节点。</li> <li><code>cluster replicate &lt;node_id&gt;</code> - 将当前节点设置为 node_id 指定的节点的从节点。</li> <li><code>cluster saveconfig</code> - 将节点的配置文件保存到硬盘里面。</li></ul></li> <li><strong>槽(slot)</strong> <ul><li><code>cluster addslots &lt;slot&gt; [slot ...]</code> - 将一个或多个槽（ slot）指派（ assign）给当前节点。</li> <li><code>cluster delslots &lt;slot&gt; [slot ...]</code> - 移除一个或多个槽对当前节点的指派。</li> <li><code>cluster flushslots</code> - 移除指派给当前节点的所有槽，让当前节点变成一个没有指派任何槽的节点。</li> <li><code>cluster setslot &lt;slot&gt; node &lt;node_id&gt;</code> - 将槽 slot 指派给 node_id 指定的节点，如果槽已经指派给另一个节点，那么先让另一个节点删除该槽&gt;，然后再进行指派。</li> <li><code>cluster setslot &lt;slot&gt; migrating &lt;node_id&gt;</code> - 将本节点的槽 slot 迁移到 node_id 指定的节点中。</li> <li><code>cluster setslot &lt;slot&gt; importing &lt;node_id&gt;</code> - 从 node_id 指定的节点中导入槽 slot 到本节点。</li> <li><code>cluster setslot &lt;slot&gt; stable</code> - 取消对槽 slot 的导入（ import）或者迁移（ migrate）。</li></ul></li> <li><strong>键</strong> <ul><li><code>cluster keyslot &lt;key&gt;</code> - 计算键 key 应该被放置在哪个槽上。</li> <li><code>cluster countkeysinslot &lt;slot&gt;</code> - 返回槽 slot 目前包含的键值对数量。</li> <li><code>cluster getkeysinslot &lt;slot&gt; &lt;count&gt;</code> - 返回 count 个 slot 槽中的键。</li></ul></li></ul> <h2 id="压力测试"><a href="#压力测试" class="header-anchor">#</a> 压力测试</h2> <blockquote><p>参考官方文档：<a href="https://redis.io/topics/benchmarks" target="_blank" rel="noopener noreferrer">How fast is Redis?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>Redis 自带了一个性能测试工具：<code>redis-benchmark</code></p> <p><strong>（1）基本测试</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>redis-benchmark -q -n <span class="token number">100000</span>
</code></pre></div><ul><li><code>-q</code> 表示静默（quiet）执行</li> <li><code>-n 100000</code> 请求 10 万次</li></ul> <p><strong>（2）测试指定读写指令</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ redis-benchmark -t set,lpush -n <span class="token number">100000</span> -q
SET: <span class="token number">74239.05</span> requests per second
LPUSH: <span class="token number">79239.30</span> requests per second
</code></pre></div><p><strong>（3）测试 pipeline 模式下指定读写指令</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>redis-benchmark -n <span class="token number">1000000</span> -t set,get -P <span class="token number">16</span> -q
SET: <span class="token number">403063.28</span> requests per second
GET: <span class="token number">508388.41</span> requests per second
</code></pre></div><h2 id="客户端"><a href="#客户端" class="header-anchor">#</a> 客户端</h2> <p>推荐使用 <a href="https://github.com/uglide/RedisDesktopManager" target="_blank" rel="noopener noreferrer"><strong>RedisDesktopManager</strong><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="脚本"><a href="#脚本" class="header-anchor">#</a> 脚本</h2> <blockquote><p>CentOS7 环境安装脚本：<a href="https://github.com/dunwu/linux-tutorial/tree/master/codes/linux/soft" target="_blank" rel="noopener noreferrer">软件运维配置脚本集合<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p><strong>安装说明</strong></p> <ul><li>采用编译方式安装 Redis, 并将其注册为 systemd 服务</li> <li>安装路径为：<code>/usr/local/redis</code></li> <li>默认下载安装 <code>5.0.4</code> 版本，端口号为：<code>6379</code>，密码为空</li></ul> <p><strong>使用方法</strong></p> <ul><li>默认安装 - 执行以下任意命令即可：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">curl</span> -o- https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh <span class="token operator">|</span> <span class="token function">bash</span>
<span class="token function">wget</span> -qO- https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh <span class="token operator">|</span> <span class="token function">bash</span>
</code></pre></div><ul><li>自定义安装 - 下载脚本到本地，并按照以下格式执行：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sh</span> redis-install.sh <span class="token punctuation">[</span>version<span class="token punctuation">]</span> <span class="token punctuation">[</span>port<span class="token punctuation">]</span> <span class="token punctuation">[</span>password<span class="token punctuation">]</span>
</code></pre></div><p>参数说明：</p> <ul><li><code>version</code> - redis 版本号</li> <li><code>port</code> - redis 服务端口号</li> <li><code>password</code> - 访问密码</li></ul> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><strong>官网</strong> <ul><li><a href="https://redis.io/" target="_blank" rel="noopener noreferrer">Redis 官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/antirez/redis" target="_blank" rel="noopener noreferrer">Redis github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://redis.cn/" target="_blank" rel="noopener noreferrer">Redis 官方文档中文版<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><strong>书籍</strong> <ul><li><a href="https://item.jd.com/11791607.html" target="_blank" rel="noopener noreferrer">《Redis 实战》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://item.jd.com/11486101.html" target="_blank" rel="noopener noreferrer">《Redis 设计与实现》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><strong>教程</strong> <ul><li><a href="http://redisdoc.com/" target="_blank" rel="noopener noreferrer">Redis 命令参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><strong>文章</strong> <ul><li><a href="https://juejin.im/post/5b8fc5536fb9a05d2d01fb11" target="_blank" rel="noopener noreferrer">深入剖析 Redis 系列(三) - Redis 集群模式搭建与原理详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/db-tutorial/edit/master/docs/nosql/redis/redis-ops.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/db-tutorial/assets/js/app.1637c1a8.js" defer></script><script src="/db-tutorial/assets/js/4.988cd28a.js" defer></script><script src="/db-tutorial/assets/js/33.d8a98227.js" defer></script><script src="/db-tutorial/assets/js/5.97e60065.js" defer></script>
  </body>
</html>
