<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis 面试总结 | DB-TUTORIAL</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/db-tutorial/favicon.ico">
    <meta name="description" content="数据库教程">
    <link rel="preload" href="/db-tutorial/assets/css/0.styles.9890eb14.css" as="style"><link rel="preload" href="/db-tutorial/assets/js/app.1637c1a8.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/4.988cd28a.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/32.04c7c31e.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/5.97e60065.js" as="script"><link rel="prefetch" href="/db-tutorial/assets/js/10.d6c4ab98.js"><link rel="prefetch" href="/db-tutorial/assets/js/11.bcdc854a.js"><link rel="prefetch" href="/db-tutorial/assets/js/12.b1c5ccd6.js"><link rel="prefetch" href="/db-tutorial/assets/js/13.0231d26c.js"><link rel="prefetch" href="/db-tutorial/assets/js/14.1353e10c.js"><link rel="prefetch" href="/db-tutorial/assets/js/15.77beb8c8.js"><link rel="prefetch" href="/db-tutorial/assets/js/16.95cb18f5.js"><link rel="prefetch" href="/db-tutorial/assets/js/17.391d32ef.js"><link rel="prefetch" href="/db-tutorial/assets/js/18.962a1d95.js"><link rel="prefetch" href="/db-tutorial/assets/js/19.4fe1aa3c.js"><link rel="prefetch" href="/db-tutorial/assets/js/20.fd0add2b.js"><link rel="prefetch" href="/db-tutorial/assets/js/21.9c5de472.js"><link rel="prefetch" href="/db-tutorial/assets/js/22.58cf4ab2.js"><link rel="prefetch" href="/db-tutorial/assets/js/23.4e1a22c2.js"><link rel="prefetch" href="/db-tutorial/assets/js/24.cc3769c6.js"><link rel="prefetch" href="/db-tutorial/assets/js/25.e2074f54.js"><link rel="prefetch" href="/db-tutorial/assets/js/26.befb3037.js"><link rel="prefetch" href="/db-tutorial/assets/js/27.b4d75a01.js"><link rel="prefetch" href="/db-tutorial/assets/js/28.3f95cfb3.js"><link rel="prefetch" href="/db-tutorial/assets/js/29.8f97f10b.js"><link rel="prefetch" href="/db-tutorial/assets/js/30.39d20b2c.js"><link rel="prefetch" href="/db-tutorial/assets/js/31.fc2f71e8.js"><link rel="prefetch" href="/db-tutorial/assets/js/33.d8a98227.js"><link rel="prefetch" href="/db-tutorial/assets/js/34.f3f76f91.js"><link rel="prefetch" href="/db-tutorial/assets/js/35.9e1d9fd5.js"><link rel="prefetch" href="/db-tutorial/assets/js/36.8223f208.js"><link rel="prefetch" href="/db-tutorial/assets/js/37.2e5375d8.js"><link rel="prefetch" href="/db-tutorial/assets/js/38.0873d536.js"><link rel="prefetch" href="/db-tutorial/assets/js/39.0daadf13.js"><link rel="prefetch" href="/db-tutorial/assets/js/40.9dff4cfb.js"><link rel="prefetch" href="/db-tutorial/assets/js/41.f8b293a9.js"><link rel="prefetch" href="/db-tutorial/assets/js/42.550ed28e.js"><link rel="prefetch" href="/db-tutorial/assets/js/43.622c2625.js"><link rel="prefetch" href="/db-tutorial/assets/js/44.0fc5b838.js"><link rel="prefetch" href="/db-tutorial/assets/js/45.5a4964c8.js"><link rel="prefetch" href="/db-tutorial/assets/js/46.c49dba33.js"><link rel="prefetch" href="/db-tutorial/assets/js/47.53ce644b.js"><link rel="prefetch" href="/db-tutorial/assets/js/48.83d4e4ce.js"><link rel="prefetch" href="/db-tutorial/assets/js/49.36414ad9.js"><link rel="prefetch" href="/db-tutorial/assets/js/50.1394d06e.js"><link rel="prefetch" href="/db-tutorial/assets/js/51.0fea6988.js"><link rel="prefetch" href="/db-tutorial/assets/js/52.f10ee7c4.js"><link rel="prefetch" href="/db-tutorial/assets/js/53.f598ca7d.js"><link rel="prefetch" href="/db-tutorial/assets/js/54.6408c8d2.js"><link rel="prefetch" href="/db-tutorial/assets/js/6.0b3ccab2.js"><link rel="prefetch" href="/db-tutorial/assets/js/7.ac8df731.js"><link rel="prefetch" href="/db-tutorial/assets/js/8.df37c1ad.js"><link rel="prefetch" href="/db-tutorial/assets/js/9.0382c4b4.js"><link rel="prefetch" href="/db-tutorial/assets/js/vendors~flowchart.8982e116.js"><link rel="prefetch" href="/db-tutorial/assets/js/vendors~notification.f509967c.js">
    <link rel="stylesheet" href="/db-tutorial/assets/css/0.styles.9890eb14.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/db-tutorial/" class="home-link router-link-active"><img src="images/dunwu-logo-100.png" alt="DB-TUTORIAL" class="logo"> <span class="site-name can-hide">DB-TUTORIAL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="sql" class="dropdown-title"><span class="title">sql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/sql/mysql/" class="nav-link">
  Mysql
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="nosql" class="dropdown-title"><span class="title">nosql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/nosql/redis/" class="nav-link router-link-active">
  Redis
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎯 博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/db-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="sql" class="dropdown-title"><span class="title">sql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/sql/mysql/" class="nav-link">
  Mysql
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="nosql" class="dropdown-title"><span class="title">nosql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/nosql/redis/" class="nav-link router-link-active">
  Redis
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎯 博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/db-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Redis 面试总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/nosql/redis/redis-interview.html#redis-数据类型" class="sidebar-link">Redis 数据类型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/nosql/redis/redis-interview.html#redis-内存淘汰" class="sidebar-link">Redis 内存淘汰</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/nosql/redis/redis-interview.html#redis-持久化" class="sidebar-link">Redis 持久化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/nosql/redis/redis-interview.html#redis-高并发" class="sidebar-link">Redis 高并发</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/nosql/redis/redis-interview.html#redis-高可用" class="sidebar-link">Redis 高可用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/nosql/redis/redis-interview.html#redis-复制" class="sidebar-link">Redis 复制</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/nosql/redis/redis-interview.html#redis-事务" class="sidebar-link">Redis 事务</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/nosql/redis/redis-interview.html#redis-vs-memcached" class="sidebar-link">Redis vs. Memcached</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-interview.html#redis-与-memcached-的选择" class="sidebar-link">Redis 与 Memcached 的选择</a></li></ul></li><li><a href="/db-tutorial/nosql/redis/redis-interview.html#参考资料" class="sidebar-link">参考资料</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis-面试总结"><a href="#redis-面试总结" class="header-anchor">#</a> Redis 面试总结</h1> <h2 id="redis-数据类型"><a href="#redis-数据类型" class="header-anchor">#</a> Redis 数据类型</h2> <p>问题：</p> <ul><li>Redis 数据类型有哪些？</li> <li>Redis 各种数据类型适用于什么样的场景？</li></ul> <hr> <p>解答：</p> <p>Redis 基本数据类型：</p> <table><thead><tr><th>数据类型</th> <th>可以存储的值</th> <th>操作</th></tr></thead> <tbody><tr><td>STRING</td> <td>字符串、整数或者浮点数</td> <td>对整个字符串或者字符串的其中一部分执行操作<br> 对整数和浮点数执行自增或者自减操作</td></tr> <tr><td>LIST</td> <td>列表</td> <td>从两端压入或者弹出元素<br> 读取单个或者多个元素<br> 进行修剪，只保留一个范围内的元素</td></tr> <tr><td>SET</td> <td>无序集合</td> <td>添加、获取、移除单个元素<br> 检查一个元素是否存在于集合中<br> 计算交集、并集、差集<br> 从集合里面随机获取元素</td></tr> <tr><td>HASH</td> <td>包含键值对的无序散列表</td> <td>添加、获取、移除单个键值对<br> 获取所有键值对<br> 检查某个键是否存在</td></tr> <tr><td>ZSET</td> <td>有序集合</td> <td>添加、获取、删除元素<br> 根据分值范围或者成员来获取元素<br> 计算一个键的排名</td></tr></tbody></table> <p>Redis 各种数据类型的应用比较繁杂，详情可以参考：<a href="https://github.com/dunwu/db-tutorial/blob/master/docs/nosql/redis/redis-datatype.md" target="_blank" rel="noopener noreferrer">Redis 数据类型<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="redis-内存淘汰"><a href="#redis-内存淘汰" class="header-anchor">#</a> Redis 内存淘汰</h2> <p>问题：</p> <ul><li>Redis 有哪些淘汰策略？</li> <li>这些淘汰策略分别适用于什么场景？</li> <li>Redis 有哪些删除失效 key 的方法？</li> <li>如何设置 Redis 中键的过期时间？</li> <li>如果让你实现一个 LRU 算法，怎么做？</li></ul> <hr> <p>解答：</p> <p>Redis 内存淘汰策略：</p> <ul><li><strong><code>noeviction</code></strong> - 当内存使用达到阈值的时候，所有引起申请内存的命令会报错。这是 Redis 默认的策略。</li> <li><strong><code>allkeys-lru</code></strong> - 在主键空间中，优先移除最近未使用的 key。</li> <li><strong><code>allkeys-random</code></strong> - 在主键空间中，随机移除某个 key。</li> <li><strong><code>volatile-lru</code></strong> - 在设置了过期时间的键空间中，优先移除最近未使用的 key。</li> <li><strong><code>volatile-random</code></strong> - 在设置了过期时间的键空间中，随机移除某个 key。</li> <li><strong><code>volatile-ttl</code></strong> - 在设置了过期时间的键空间中，具有更早过期时间的 key 优先移除。</li></ul> <p>如何选择内存淘汰策略：</p> <ul><li>如果数据呈现幂等分布，也就是一部分数据访问频率高，一部分数据访问频率低，则使用 <code>allkeys-lru</code>。</li> <li>如果数据呈现平等分布，也就是所有的数据访问频率都相同，则使用 <code>allkeys-random</code>。</li> <li><code>volatile-lru</code> 策略和 <code>volatile-random</code> 策略适合我们将一个 Redis 实例既应用于缓存和又应用于持久化存储的时候，然而我们也可以通过使用两个 Redis 实例来达到相同的效果。</li> <li>将 key 设置过期时间实际上会消耗更多的内存，因此我们建议使用 <code>allkeys-lru</code> 策略从而更有效率的使用内存。</li></ul> <p>Redis 删除失效主键的方法主要有两种：</p> <ul><li>消极方法（passive way），在主键被访问时如果发现它已经失效，那么就删除它。</li> <li>主动方法（active way），周期性地从设置了失效时间的主键中选择一部分失效的主键删除。</li></ul> <p>LRU 算法实现思路：</p> <p><code>HashMap</code> + <code>LinkedList</code></p> <h2 id="redis-持久化"><a href="#redis-持久化" class="header-anchor">#</a> Redis 持久化</h2> <p>问题：</p> <ul><li>Redis 有哪些持久化方式？</li> <li>Redis 的不同持久化方式的特性和原理是什么？</li> <li>RDB 和 AOF 各有什么优缺点？分别适用于什么样的场景？</li> <li>Redis 执行持久化时，可以处理请求吗？</li> <li>AOF 有几种同步频率？</li></ul> <hr> <p>解答：</p> <p>Redis 支持两种持久化方式：RDB 和 AOF。</p> <p>RDB 即快照方式，它将某个时间点的所有 Redis 数据保存到一个经过压缩的二进制文件（RDB 文件）中。</p> <p>AOF(Append Only File) 是以文本日志形式将所有写命令追加到 AOF 文件的末尾，以此来记录数据的变化。</p> <p>更详细的特性及原理说明请参考：<a href="https://github.com/dunwu/db-tutorial/blob/master/docs/nosql/redis/redis-persistence.md" target="_blank" rel="noopener noreferrer">Redis 持久化<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="redis-高并发"><a href="#redis-高并发" class="header-anchor">#</a> Redis 高并发</h2> <p>问题：</p> <ul><li>Redis 是单线程模型，为何吞吐量还很高？</li> <li>Redis 集群如何分片和寻址？</li> <li>Redis 集群如何扩展？</li> <li>Redis 集群如何保证数据一致？</li> <li>Redis 集群如何规划？你们公司的生产环境上如何部署 Redis 集群？</li> <li>Redis 的并发竞争问题如何解决?</li></ul> <hr> <p>解答：</p> <p>Redis 为单进程单线程模式，采用队列模式将并发访问变为串行访问。</p> <p>Redis 单机吞吐量也很高，能达到几万 QPS，但需要格外注意的是：<strong>Redis 是单线程模型</strong>。很多人可能会奇怪，Redis 是单线程模型，如何能处理高并发请求呢？</p> <p>原因在于：</p> <ul><li>Redis 读写都是内存操作。</li> <li>Redis 基于<strong>非阻塞的 IO 多路复用机制</strong>，同时监听多个 socket，将产生事件的 socket 压入内存队列中，事件分派器根据 socket 上的事件类型来选择对应的事件处理器进行处理。</li> <li>单线程，避免了线程创建、销毁、上下文切换的开销，并且避免了资源竞争。</li></ul> <p>Redis 的高并发通过主从架构来实现。Redis 集群采用主从模型，提供复制和故障转移功能，来保证 Redis 集群的高可用。通常情况，一主多从模式已经可以满足大部分项目的需要。根据实际的并发量，可以通过增加节点来扩展并发吞吐。</p> <p>一主多从模式下，主节点负责写操作（单机几万 QPS），从节点负责查询操作（单机十万 QPS）。</p> <p>进一步，如果需要缓存大量数据，就需要分区（sharding），Redis 集群通过划分虚拟 hash 槽来分片，进行数据分享。</p> <p>根据 CAP 理论，Consistency、Availability、Partition tolerance 三者不可兼得，而 Redis 集群的选择是 AP。Redis 集群节点间采用异步通信方式，不保证强一致性，尽力达到最终一致性。</p> <p><code>Redis</code> 集群一般由 <strong>多个节点</strong> 组成，节点数量至少为 <code>6</code> 个，才能保证组成 <strong>完整高可用</strong> 的集群。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/10/10/16db5250b0d1c392?w=1467&amp;h=803&amp;f=png&amp;s=43428" alt="img"></p> <p>更详细的特性及原理说明请参考：<a href="https://github.com/dunwu/db-tutorial/blob/master/docs/nosql/redis/redis-cluster.md" target="_blank" rel="noopener noreferrer">Redis 集群<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="redis-高可用"><a href="#redis-高可用" class="header-anchor">#</a> Redis 高可用</h2> <p>问题：</p> <ul><li>Redis 如何实现高可用？</li> <li>Redis 哨兵的功能？</li> <li>Redis 哨兵的原理？</li> <li>Redis 哨兵如何选举 Leader？</li> <li>Redis 如何实现故障转移？</li></ul> <hr> <p>解答：</p> <p>Redis 的高可用是通过哨兵来实现（Raft 协议的 Redis 实现）。Sentinel（哨兵）可以监听主服务器，并在主服务器进入下线状态时，自动从从服务器中选举出新的主服务器。</p> <p>由一个或多个 Sentinel 实例组成的 Sentinel 系统可以监视任意多个主服务器，以及这些主服务器的所有从服务器，并在被监视的主服务器进入下线状态时，自动将下线主服务器的某个从服务器升级为新的主服务器，然后由新的主服务器代替已下线的主服务器继续处理命令请求。</p> <p><img src="http://dunwu.test.upcdn.net/snap/20200131135847.png" alt="img"></p> <p>更详细的特性及原理说明请参考：<a href="https://github.com/dunwu/db-tutorial/blob/master/docs/nosql/redis/redis-sentinel.md" target="_blank" rel="noopener noreferrer">Redis 哨兵<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="redis-复制"><a href="#redis-复制" class="header-anchor">#</a> Redis 复制</h2> <p>问题：</p> <ul><li>Redis 复制的工作原理？Redis 旧版复制和新版复制有何不同？</li> <li>Redis 主从节点间如何复制数据？</li> <li>Redis 的数据一致性是强一致性吗？</li></ul> <hr> <p>解答：</p> <p>旧版复制基于 <code>SYNC</code> 命令实现。分为同步（sync）和命令传播（command propagate）两个操作。这种方式存在缺陷：不能高效处理断线重连后的复制情况。</p> <p>新版复制基于 <code>PSYNC</code> 命令实现。同步操作分为了两块：</p> <ul><li><strong><code>完整重同步（full resychronization）</code></strong> 用于初次复制；</li> <li><strong><code>部分重同步（partial resychronization）</code></strong> 用于断线后重复制。
<ul><li>主从服务器的<strong>复制偏移量（replication offset）</strong></li> <li>主服务器的<strong>复制积压缓冲区（replication backlog）</strong></li> <li><strong>服务器的运行 ID</strong></li></ul></li></ul> <p>Redis 集群主从节点复制的工作流程：</p> <ul><li>步骤 1. 设置主从服务器</li> <li>步骤 2. 主从服务器建立 TCP 连接。</li> <li>步骤 3. 发送 PING 检查通信状态。</li> <li>步骤 4. 身份验证。</li> <li>步骤 5. 发送端口信息。</li> <li>步骤 6. 同步。</li> <li>步骤 7. 命令传播。</li></ul> <p>更详细的特性及原理说明请参考：<a href="https://github.com/dunwu/db-tutorial/blob/master/docs/nosql/redis/redis-replication.md" target="_blank" rel="noopener noreferrer">Redis 复制<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="redis-事务"><a href="#redis-事务" class="header-anchor">#</a> Redis 事务</h2> <p>问题：</p> <ul><li>Redis 支持事务吗？</li> <li>Redis 事务是严格意义的事务吗？Redis 为什么不支持回滚。</li> <li>Redis 事务如何工作？</li> <li>了解 Redis 事务中的 CAS 行为吗？</li> <li>除了事务，还有其他批量执行 Redis 命令的方式吗？</li></ul> <p>解答：</p> <p><strong>Redis 提供的不是严格的事务，Redis 只保证串行执行命令，并且能保证全部执行，但是执行命令失败时并不会回滚，而是会继续执行下去</strong>。</p> <p>Redis 不支持回滚的理由：</p> <ul><li>Redis 命令只会因为错误的语法而失败，或是命令用在了错误类型的键上面。</li> <li>因为不需要对回滚进行支持，所以 Redis 的内部可以保持简单且快速。</li></ul> <p><code>MULTI</code> 、 <code>EXEC</code> 、 <code>DISCARD</code> 和 <code>WATCH</code> 是 Redis 事务相关的命令。</p> <ul><li><strong><a href="https://redis.io/commands/multi" target="_blank" rel="noopener noreferrer"><code>MULTI</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 命令用于开启一个事务，它总是返回 OK 。</strong></li> <li><strong><a href="https://redis.io/commands/exec" target="_blank" rel="noopener noreferrer"><code>EXEC</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 命令负责触发并执行事务中的所有命令。</strong></li> <li><strong>当执行 <a href="https://redis.io/commands/discard" target="_blank" rel="noopener noreferrer"><code>DISCARD</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 命令时， 事务会被放弃， 事务队列会被清空， 并且客户端会从事务状态中退出。</strong></li> <li>**<a href="https://redis.io/commands/watch" target="_blank" rel="noopener noreferrer"><code>WATCH</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 命令可以为 Redis 事务提供 check-and-set （CAS）行为。**被 WATCH 的键会被监视，并会发觉这些键是否被改动过了。 如果有至少一个被监视的键在 EXEC 执行之前被修改了， 那么整个事务都会被取消， EXEC 返回 nil-reply 来表示事务已经失败。</li></ul> <p>Redis 是一种基于 C/S 模型以及请求/响应协议的 TCP 服务。Redis 支持管道技术。管道技术允许请求以异步方式发送，即旧请求的应答还未返回的情况下，允许发送新请求。这种方式可以大大提高传输效率。使用管道发送命令时，Redis Server 会将部分请求放到缓存队列中（占用内存），执行完毕后一次性发送结果。如果需要发送大量的命令，会占用大量的内存，因此应该按照合理数量分批次的处理。</p> <h2 id="redis-vs-memcached"><a href="#redis-vs-memcached" class="header-anchor">#</a> Redis vs. Memcached</h2> <p>Redis 不仅仅支持简单的 k/v 类型的数据，同时还提供 list，set，zset，hash 等数据结构的存储。memcache 支持简单的数据类型，String。</p> <p>Redis 支持数据的备份，即 master-slave 模式的数据备份。</p> <p>Redis 支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用,而 Memecache 把数据全部存在内存之中</p> <p>redis 的速度比 memcached 快很多</p> <p>Memcached 是多线程，非阻塞 IO 复用的网络模型；Redis 使用单线程的 IO 复用模型。</p> <p><img src="https://user-gold-cdn.xitu.io/2018/4/18/162d7773080d4570?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Redis与Memcached的区别与比较"></p> <p>如果想要更详细了解的话，可以查看慕课网上的这篇手记（非常推荐） <strong>：《脚踏两只船的困惑 - Memcached 与 Redis》</strong>：<a href="https://www.imooc.com/article/23549" target="_blank" rel="noopener noreferrer">www.imooc.com/article/23549<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="redis-与-memcached-的选择"><a href="#redis-与-memcached-的选择" class="header-anchor">#</a> Redis 与 Memcached 的选择</h3> <p><strong>终极策略：</strong> 使用 Redis 的 String 类型做的事，都可以用 Memcached 替换，以此换取更好的性能提升； 除此以外，优先考虑 Redis；</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://juejin.im/post/5ad6e4066fb9a028d82c4b66" target="_blank" rel="noopener noreferrer">面试中关于 Redis 的问题看这篇就够了<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/db-tutorial/edit/master/docs/nosql/redis/redis-interview.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/db-tutorial/assets/js/app.1637c1a8.js" defer></script><script src="/db-tutorial/assets/js/4.988cd28a.js" defer></script><script src="/db-tutorial/assets/js/32.04c7c31e.js" defer></script><script src="/db-tutorial/assets/js/5.97e60065.js" defer></script>
  </body>
</html>
